<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • Bioc2020RCWL</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="Bioc2020RCWL">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93043521-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93043521-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Bioc2020RCWL</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/Bioc2020RCWL.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hubentu/Bioc2020Rcwl">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Bioc2020RCWL_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="Bioc2020RCWL_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="Bioc2020RCWL_files/viz-1.8.2/viz.js"></script><link href="Bioc2020RCWL_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="Bioc2020RCWL_files/grViz-binding-1.0.6.1/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      
      <div class="hidden name"><code>Bioc2020RCWL.Rmd</code></div>

    </div>

    
    
<div id="connecting-bioconductor-to-other-bioinformatics-tools-using-rcwl" class="section level1">
<h1 class="hasAnchor">
<a href="#connecting-bioconductor-to-other-bioinformatics-tools-using-rcwl" class="anchor"></a>Connecting Bioconductor to other bioinformatics tools using <code>Rcwl</code>
</h1>
<div id="instructors-names-and-contact-information" class="section level2">
<h2 class="hasAnchor">
<a href="#instructors-names-and-contact-information" class="anchor"></a>Instructor(s) name(s) and contact information</h2>
<ul>
<li>
<a href="https://github.com/liubuntu">Qian Liu</a> (<a href="mailto:Qian.Liu@roswellpark.org" class="email">Qian.Liu@roswellpark.org</a>)</li>
<li>
<a href="https://github.com/hubentu">Qiang Hu</a> (<a href="mailto:Qiang.Hu@roswellpark.org" class="email">Qiang.Hu@roswellpark.org</a>)</li>
</ul>
</div>
<div id="workshop-description" class="section level2">
<h2 class="hasAnchor">
<a href="#workshop-description" class="anchor"></a>Workshop Description</h2>
<p>This workshop introduces the Bioconductor toolchain for usage and development of reproducible bioinformatics pipelines using packages of Rcwl and RcwlPipelines. The Common Workflow Language (CWL) is an open standard for development of data analysis workflows that is portable and scalable across different tools and working environments. Rcwl provides a simple way to wrap command line tools and build CWL data analysis pipelines programmatically within R. It increases the ease of development, usage, and maintenance of CWL pipelines, and furthermore offers higher performance by intuitively supporting parallel work on high performance computing (HPC). hundreds of pre-built bioinformatics pipelines in CWL are included in RcwlPipelines. The tools and pipelines are highly modularized for easy customization of complex bioinformatics analysis. An scRNA-seq pipeline using STARsolo for alignment and quantification, DropletUtils for filtering raw gene-barcode matrix, fastqc and multiqc for reads quality control will demonstrate the typical use case of these two packages. More details for usage and examples are available on Rcwl website: <a href="https://hubentu.github.io/Rcwl/" class="uri">https://hubentu.github.io/Rcwl/</a>.</p>
</div>
<div id="pre-requisites" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-requisites" class="anchor"></a>Pre-requisites</h2>
<ul>
<li>Basic knowledge of R and usage of Bioconductor packages for NGS analysis</li>
<li>Basic familiarity with running command-line tools</li>
<li>No prior experience with CWL is necessary!</li>
</ul>
</div>
<div id="workshop-participation" class="section level2">
<h2 class="hasAnchor">
<a href="#workshop-participation" class="anchor"></a>Workshop Participation</h2>
<p>Participants will be able to try out all of the functionality described. Active user participation throughout the event is highly encouraged including but not limited to lecture material, hands-on sections and final discussion.</p>
<p>Some basic idea about how CWL works. * <a href="https://www.commonwl.org/user_guide/" class="uri">https://www.commonwl.org/user_guide/</a></p>
</div>
<div id="r-bioconductor-packages-used" class="section level2">
<h2 class="hasAnchor">
<a href="#r-bioconductor-packages-used" class="anchor"></a><em>R</em> / <em>Bioconductor</em> packages used</h2>
<ul>
<li><a href="https://bioconductor.org/packages/Rcwl/"><code>Rcwl</code></a></li>
<li><a href="https://bioconductor.org/packages/RcwlPipelines/"><code>RcwlPipelines</code></a></li>
<li>
<a href="https://bioconductor.org/packages/BiocParallel/"><code>BiocParallel</code></a> *<a href="https://CRAN.R-project.org/package=shiny"><code>shiny</code></a>
</li>
</ul>
<p>System dependencies * <a href="https://github.com/common-workflow-language/cwltool">cwltool</a> * <a href="https://docs.docker.com/get-docker/">docker</a></p>
</div>
<div id="time-outline" class="section level2">
<h2 class="hasAnchor">
<a href="#time-outline" class="anchor"></a>Time outline</h2>
<table class="table">
<thead><tr class="header">
<th>Activity</th>
<th>Time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Overview of bioinformatics pipelines and CWL</td>
<td>15m</td>
</tr>
<tr class="even">
<td>Use existing bioinfo pipelines in <code>RcwlPipelines</code>
</td>
<td>15m</td>
</tr>
<tr class="odd">
<td>Wrap command line tools using <code>Rcwl</code>
</td>
<td>15m</td>
</tr>
<tr class="even">
<td>Customize your own pipelines using <code>Rcwl</code>
</td>
<td>15m</td>
</tr>
</tbody>
</table>
</div>
<div id="workshop-goals-and-objectives" class="section level2">
<h2 class="hasAnchor">
<a href="#workshop-goals-and-objectives" class="anchor"></a>Workshop goals and objectives</h2>
<div id="learning-goals" class="section level3">
<h3 class="hasAnchor">
<a href="#learning-goals" class="anchor"></a>Learning goals</h3>
<ul>
<li>Basic knowledge of Common Workflow Language (CWL)</li>
<li>Knowledge of R/Bioconductor interface of CWL</li>
<li>Usage of the pre-built bioinformatics pipelines in R</li>
<li>Understand how to wrap command line tools with Rcwl</li>
<li>Understand how to build bioinformatics pipelines with Rcwl</li>
</ul>
</div>
<div id="learning-objectives" class="section level3">
<h3 class="hasAnchor">
<a href="#learning-objectives" class="anchor"></a>Learning objectives</h3>
<ul>
<li>Run the scRNA-seq pipeline included in RcwlPipelines</li>
<li>Create a basic echo tool using Rcwl</li>
<li>Build a simple scRNA-seq alignment tool STARsolo</li>
</ul>
</div>
</div>
<div id="introduction-to-cwl" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-cwl" class="anchor"></a>Introduction to CWL</h2>
<p>CWL CommandLineTool description:</p>
<p>CWL Workflow description:</p>
</div>
<div id="rcwl" class="section level2">
<h2 class="hasAnchor">
<a href="#rcwl" class="anchor"></a>Rcwl</h2>
<div id="introduction-to-rcwl" class="section level3">
<h3 class="hasAnchor">
<a href="#introduction-to-rcwl" class="anchor"></a>Introduction to Rcwl</h3>
<div id="rcwl-setup" class="section level4">
<h4 class="hasAnchor">
<a href="#rcwl-setup" class="anchor"></a>Rcwl setup</h4>
<p>The <code>Rcwl</code> package is aimed at a simple and user-friendly way to manage command line tools and build data analysis pipelines in R using Common Workflow Language (CWL). The <code>Rcwl</code> and <code>RcwlPipelines</code> packages are available in Bioc 3.11 and R &gt;= 3.6. You can install them by the <code>BiocManager</code> package.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"RcwlPipelines"</span>, <span class="kw">quietly</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
    <span class="kw pkg">BiocManager</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Rcwl"</span>, <span class="st">"RcwlPipelines"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">Rcwl</span>)</pre></body></html></div>
<pre><code>## Loading required package: yaml</code></pre>
<pre><code>## Loading required package: S4Vectors</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## Loading required package: BiocGenerics</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## 
## Attaching package: 'BiocGenerics'</code></pre>
<pre><code>## The following objects are masked from 'package:parallel':
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     IQR, mad, sd, var, xtabs</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     anyDuplicated, append, as.data.frame, basename, cbind, colnames,
##     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
##     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
##     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
##     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
##     union, unique, unsplit, which.max, which.min</code></pre>
<pre><code>## 
## Attaching package: 'S4Vectors'</code></pre>
<pre><code>## The following object is masked from 'package:base':
## 
##     expand.grid</code></pre>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RcwlPipelines</span>)</pre></body></html></div>
<pre><code>## Loading required package: BiocFileCache</code></pre>
<pre><code>## Loading required package: dbplyr</code></pre>
</div>
<div id="system-requirements" class="section level4">
<h4 class="hasAnchor">
<a href="#system-requirements" class="anchor"></a>System requirements</h4>
<p>In addition to the R packages, the following tools are required to be installed to run the examples in this document.</p>
<ul>
<li>cwltool (&gt;= 1.0.2018)</li>
<li>nodejs</li>
<li>Docker (optional)</li>
</ul>
<p>The <code>cwltool</code> is the reference implementation of the Common Workflow Language, which is used to run the CWL scripts. The <code>nodejs</code> is required when the CWL scripts use the JavaScript language. The Docker containers simplify software installation and management. A CWL runner can pull the required Docker containers automatically and adjust the paths of input files.</p>
<p>You can find instructions to install these tools here:</p>
<ul>
<li><a href="https://github.com/common-workflow-language/cwltool#install" class="uri">https://github.com/common-workflow-language/cwltool#install</a></li>
<li><a href="https://nodejs.org" class="uri">https://nodejs.org</a></li>
<li><a href="https://docs.docker.com/install" class="uri">https://docs.docker.com/install</a></li>
</ul>
</div>
</div>
<div id="first-example" class="section level3">
<h3 class="hasAnchor">
<a href="#first-example" class="anchor"></a>First example</h3>
<div id="hello-world" class="section level4">
<h4 class="hasAnchor">
<a href="#hello-world" class="anchor"></a>Hello world</h4>
<p>The main class and constructor function is <code>cwlParam</code>, which wrap a command line tool and its parameters in a <code>cwlParam</code> object. Let’s start with a simple example, <code>echo hello world</code>.</p>
<p>First, we load the package and then define the input parameter for “echo”, a string without a prefix. Just an <code>id</code> option is required.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">input1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"sth"</span>)</pre></body></html></div>
<p>Second, we create a <code>cwlParam</code> object with <code>baseCommand</code> for the command to execute and <code>InputParamList</code> for the input parameters.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">echo</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"echo"</span>, <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">input1</span>))</pre></body></html></div>
<p>Now we have a command object to run. Let’s send a string “Hello World!” to the object. Without defining the outputs, it will stream standard output to a temporary file by default.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">echo</span>$<span class="no">sth</span> <span class="kw">&lt;-</span> <span class="st">"Hello World!"</span>
<span class="no">echo</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: echo 
## inputs:
##   sth (string):  Hello World!
## outputs:
## output:
##   type: stdout</code></pre>
<p>We also defined some convenient accessor function for the <code>cwlParam</code> object.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam-methods.html">cwlVersion</a></span>(<span class="no">echo</span>)  <span class="co">## "v1.0"</span></pre></body></html></div>
<pre><code>## [1] "v1.0"</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam-methods.html">cwlClass</a></span>(<span class="no">echo</span>)    <span class="co">## "CommandLineTool", can be ""</span></pre></body></html></div>
<pre><code>## [1] "CommandLineTool"</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam-methods.html">baseCommand</a></span>(<span class="no">echo</span>) <span class="co">## "echo"</span></pre></body></html></div>
<pre><code>## [1] "echo"</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">inputs</a></span>(<span class="no">echo</span>)      <span class="co">## command line arguments and values</span></pre></body></html></div>
<pre><code>## inputs:
##   sth (string):  Hello World!</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">outputs</a></span>(<span class="no">echo</span>)     <span class="co">## the name of output results/files to be saved out to pass to later steps in pipeline</span></pre></body></html></div>
<pre><code>## outputs:
## output:
##   type: stdout</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam-methods.html">arguments</a></span>(<span class="no">echo</span>)   <span class="co">## command line arguments</span></pre></body></html></div>
<pre><code>## list()</code></pre>
</div>
<div id="test-run" class="section level4">
<h4 class="hasAnchor">
<a href="#test-run" class="anchor"></a>Test run</h4>
<p>The function <code>runCWL</code> is used to run the CWL object by invoking the python tool <code>cwltool</code>. The return will be a list including the command executed, temporary output and logs. The output directory is the current folder by default, but it can be changed by setting <code>outdir</code> option. All standard out and standard error stream can also be printed by setting <code>stderr = ""</code>.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">r1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">echo</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="no">r1</span></pre></body></html></div>
<pre><code>## List of length 3
## names(3): command output logs</code></pre>
<p>First Let’s check the output file to make sure the command was executed successfully.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">r1</span>$<span class="no">output</span></pre></body></html></div>
<pre><code>## [1] "/tmp/Rtmp7zc3UQ/65cd0d4bb817451607b84f66dc5f4c0ea52d63c3"</code></pre>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">r1</span>$<span class="no">output</span>)</pre></body></html></div>
<pre><code>## [1] "Hello World!"</code></pre>
<p>Here is the actual command line code (genearted from running <code>runCWL</code>) that was executed by <code>cwltools</code>.</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">r1</span>$<span class="no">command</span></pre></body></html></div>
<pre><code>## [1] "\033[1;30mINFO\033[0m [job file5183d70e8ae.cwl] /tmp/v63zuh64$ echo \\"     
## [2] "    'Hello World!' &gt; /tmp/v63zuh64/65cd0d4bb817451607b84f66dc5f4c0ea52d63c3"</code></pre>
<p>The log shows the details of how the <code>cwltool</code> works with CWL scripts.</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">r1</span>$<span class="no">log</span></pre></body></html></div>
<pre><code>##  [1] "\033[1;30mINFO\033[0m /usr/local/bin/cwltool 3.0.20200530110633"                                                     
##  [2] "\033[1;30mINFO\033[0m Resolved '/tmp/Rtmp7zc3UQ/file5183d70e8ae.cwl' to 'file:///tmp/Rtmp7zc3UQ/file5183d70e8ae.cwl'"
##  [3] "\033[1;30mINFO\033[0m [job file5183d70e8ae.cwl] /tmp/v63zuh64$ echo \\"                                              
##  [4] "    'Hello World!' &gt; /tmp/v63zuh64/65cd0d4bb817451607b84f66dc5f4c0ea52d63c3"                                         
##  [5] "\033[1;30mINFO\033[0m [job file5183d70e8ae.cwl] completed success"                                                   
##  [6] "{"                                                                                                                   
##  [7] "    \"output\": {"                                                                                                   
##  [8] "        \"location\": \"file:///tmp/Rtmp7zc3UQ/65cd0d4bb817451607b84f66dc5f4c0ea52d63c3\","                          
##  [9] "        \"basename\": \"65cd0d4bb817451607b84f66dc5f4c0ea52d63c3\","                                                 
## [10] "        \"class\": \"File\","                                                                                        
## [11] "        \"checksum\": \"sha1$a0b65939670bc2c010f4d5d6a0b3e4e4590fb92b\","                                            
## [12] "        \"size\": 13,"                                                                                               
## [13] "        \"path\": \"/tmp/Rtmp7zc3UQ/65cd0d4bb817451607b84f66dc5f4c0ea52d63c3\""                                      
## [14] "    }"                                                                                                               
## [15] "}"                                                                                                                   
## [16] "\033[1;30mINFO\033[0m Final process status is success"</code></pre>
<p>The <code>runCWL</code> internally generates two scripts: the configuration “.cwl” file and the input value “.yml” file. The location and prefix name of these two files are defined with the argument <code>prefix</code>, where the default is <code><a href="https://rdrr.io/r/base/tempfile.html">tempfile()</a></code>. The cwltool parses the two scripts and translates them into the command shown in <code>r1$command</code>. Since the output is not defined in <code>echo</code>, so the output was returned to <strong>stdout</strong> by default in a <code>r1$output</code>.</p>
</div>
</div>
<div id="components" class="section level3">
<h3 class="hasAnchor">
<a href="#components" class="anchor"></a>Components</h3>
<div id="input-parameters" class="section level4">
<h4 class="hasAnchor">
<a href="#input-parameters" class="anchor"></a>Input Parameters</h4>
<ol style="list-style-type: decimal">
<li>Essential Input parameters</li>
</ol>
<p>When defining the input parameters, three arguments are usually needed: <em>id</em>, <em>type</em>, and <em>prefix</em>. The <em>id</em> is a name for the input parameter which could be used later to assign values for that parameter, The <em>type</em> can be string, int, long, float, and double, etc. The <em>prefix</em> is the command line prefix that can be in varied formats based on users’ habit. More detail can be found at: &lt;htps://www.commonwl.org/v1.0/CommandLineTool.html#CWLType&gt;.</p>
<p>Here is an example from the CWL user guide(<a href="http://www.commonwl.org/user_guide/03-input/" class="uri">http://www.commonwl.org/user_guide/03-input/</a>). We defined the <code>echo</code> with different type of input parameters by <code>InputParam</code>, and the <code>stdout</code> option can be used to capture the standard output stream into a file:</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">e1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"flag"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"boolean"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-f"</span>)
<span class="no">e2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"string"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-s"</span>)
<span class="no">e3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"int"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"int"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-i"</span>)
<span class="no">e4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"file"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>,
                 <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"--file="</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">echoA</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"echo"</span>,
                  <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">e1</span>, <span class="no">e2</span>, <span class="no">e3</span>, <span class="no">e4</span>),
                  <span class="kw">stdout</span> <span class="kw">=</span> <span class="st">"output.txt"</span>)
<span class="no">echoA</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: echo 
## inputs:
##   flag (boolean): -f 
##   string (string): -s 
##   int (int): -i 
##   file (File): --file= 
## outputs:
## output:
##   type: stdout
## stdout: output.txt</code></pre>
<p>Then let’s assign values to the input parameters.</p>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="no">echoA</span>$<span class="no">flag</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>
<span class="no">echoA</span>$<span class="no">string</span> <span class="kw">&lt;-</span> <span class="st">"Hello"</span>
<span class="no">echoA</span>$<span class="no">int</span> <span class="kw">&lt;-</span> <span class="fl">1</span>
<span class="no">tmpfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/write.html">write</a></span>(<span class="st">"World"</span>, <span class="no">tmpfile</span>)
<span class="no">echoA</span>$<span class="no">file</span> <span class="kw">&lt;-</span> <span class="no">tmpfile</span>
<span class="no">r2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">echoA</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="no">r2</span>$<span class="no">command</span></pre></body></html></div>
<pre><code>## [1] "\033[1;30mINFO\033[0m [job file5185094ecca.cwl] /tmp/us8vkbne$ echo \\"                
## [2] "    --file=/tmp/tmpyp6d7fad/stg3cccf832-45fc-4b16-9470-b032f4445f9d/file51834c19f71 \\"
## [3] "    -f \\"                                                                             
## [4] "    -i \\"                                                                             
## [5] "    1 \\"                                                                              
## [6] "    -s \\"                                                                             
## [7] "    Hello &gt; /tmp/us8vkbne/output.txt"</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Array Inputs</li>
</ol>
<p>When one command line parameter takes multiple values, there are three different ways to define an array input.</p>
<div class="sourceCode" id="cb50"><html><body><pre class="r"><span class="no">a1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"A"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string[]"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-A"</span>)  <span class="co">## most common, -A a b c</span>
<span class="no">a2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"B"</span>,                                    <span class="co">## -B=d, -B=e, -B=f</span>
                 <span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputArrayParam.html">InputArrayParam</a></span>(<span class="kw">items</span> <span class="kw">=</span> <span class="st">"string"</span>,
                                        <span class="kw">prefix</span><span class="kw">=</span><span class="st">"-B="</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>))
<span class="no">a3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"C"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string[]"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-C="</span>, <span class="co">## -C=g,h,i</span>
                 <span class="kw">itemSeparator</span> <span class="kw">=</span> <span class="st">","</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">echoB</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"echo"</span>,
                 <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">a1</span>, <span class="no">a2</span>, <span class="no">a3</span>))</pre></body></html></div>
<p>We then set values for the three inputs and see how each of them print in the command line:</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">echoB</span>$<span class="no">A</span> <span class="kw">&lt;-</span> <span class="no">echoB</span>$<span class="no">B</span> <span class="kw">&lt;-</span> <span class="no">echoB</span>$<span class="no">C</span> <span class="kw">&lt;-</span> <span class="no">letters</span>[<span class="fl">1</span>:<span class="fl">3</span>]
<span class="no">echoB</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: echo 
## inputs:
##   A (string[]): -A a b c
##   B:
##     type: array
##     prefix: -B= a b c
##   C (string[]): -C= a b c
## outputs:
## output:
##   type: stdout</code></pre>
<p>Now we can check whether the command behaves as we expected.</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">r3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">echoB</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="no">r3</span>$<span class="no">command</span></pre></body></html></div>
<pre><code>## [1] "\033[1;30mINFO\033[0m [job file5187246737f.cwl] /tmp/6ia0jrd5$ echo \\"
## [2] "    -A \\"                                                             
## [3] "    a \\"                                                              
## [4] "    b \\"                                                              
## [5] "    c \\"                                                              
## [6] "    -B=a \\"                                                           
## [7] "    -B=b \\"                                                           
## [8] "    -B=c \\"                                                           
## [9] "    -C=a,b,c &gt; /tmp/6ia0jrd5/327552e14e4e8069cd0055a5a87541f23b2ac4b3"</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">r3</span>$<span class="no">output</span>)</pre></body></html></div>
<pre><code>## [1] "-A a b c -B=a -B=b -B=c -C=a,b,c"</code></pre>
</div>
<div id="output-parameters" class="section level4">
<h4 class="hasAnchor">
<a href="#output-parameters" class="anchor"></a>Output Parameters</h4>
<ol style="list-style-type: decimal">
<li>Capturing Output</li>
</ol>
<p>The outputs, similar to the inputs, is a list of output parameters. Three options, <em>id</em>, <em>type</em> and <em>glob</em>, are usually required to be defined. The <em>id</em> and <em>type</em> are similar to <code>InputParam</code>, and the <em>glob</em> option is used to define a pattern to find files relative to the output directory.</p>
<p>Here is an example to unzip a compressed <code>gz</code> file. First, we generate a compressed R script file:</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">zzfil</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">"sample.R.gz"</span>)
<span class="no">zz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">gzfile</a></span>(<span class="no">zzfil</span>, <span class="st">"w"</span>)  <span class="co">## open for writing in text mode. Can use "open=rt" to "readLines()"</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="st">"sample(1:10, 5)"</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="no">zz</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\n"</span>)    <span class="co">## a string </span>
<span class="fu"><a href="https://rdrr.io/r/base/connections.html">close</a></span>(<span class="no">zz</span>)</pre></body></html></div>
<p>The command line to do this job looks like:</p>
<pre><code>$ gzip -d -c sample.R.gz </code></pre>
<p>We then define a <code>cwlParam</code> object to use “gzip” to uncompress an input file:</p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="no">z1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"decomp"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"boolean"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-d"</span>)
<span class="no">z2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"stdout"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"boolean"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-c"</span>)
<span class="no">z3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"zfile"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>)
<span class="no">ofile</span> <span class="kw">&lt;-</span> <span class="st">"sample.R"</span>
<span class="no">o1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParam.html">OutputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"rfile"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>, <span class="kw">glob</span> <span class="kw">=</span> <span class="no">ofile</span>)
<span class="no">gz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"gzip"</span>,
               <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">z1</span>, <span class="no">z2</span>, <span class="no">z3</span>),
               <span class="kw">outputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">OutputParamList</a></span>(<span class="no">o1</span>),  <span class="co">## this is to glob the stdout file into "output" folder. </span>
                <span class="kw">stdout</span> <span class="kw">=</span> <span class="no">ofile</span>)  <span class="co">## "stdout" is to specify the stdout file. </span></pre></body></html></div>
<p>Now the <code>gz</code> object can be used to decompress the previously generated compressed file:</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="no">gz</span>$<span class="no">decomp</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>   <span class="co">## $ gzip -d</span>
<span class="no">gz</span>$<span class="no">stdout</span> <span class="kw">&lt;-</span> <span class="fl">TRUE</span>   <span class="co">## $ gzip -d -c</span>
<span class="no">gz</span>$<span class="no">zfile</span> <span class="kw">&lt;-</span> <span class="no">zzfil</span>   <span class="co">## gzip -d -c sample.R.gz</span>
<span class="no">r4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">gz</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">r4</span>$<span class="no">output</span>)</pre></body></html></div>
<pre><code>## [1] "sample(1:10, 5)"</code></pre>
<div class="sourceCode" id="cb66"><html><body><pre class="r">## print(r4$command)</pre></body></html></div>
<p>Or we can use <code>arguments</code> to set some default parameters:</p>
<div class="sourceCode" id="cb67"><html><body><pre class="r"><span class="no">z1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"zfile"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>)
<span class="no">o1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParam.html">OutputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"rfile"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>, <span class="kw">glob</span> <span class="kw">=</span> <span class="no">ofile</span>)
<span class="no">gz1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"gzip"</span>,
               <span class="kw">arguments</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"-d"</span>, <span class="st">"-c"</span>),
               <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">z1</span>),
               <span class="kw">outputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">OutputParamList</a></span>(<span class="no">o1</span>),
               <span class="kw">stdout</span> <span class="kw">=</span> <span class="no">ofile</span>)
<span class="no">gz1</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: gzip 
## arguments: -d -c 
## inputs:
##   zfile (File):  
## outputs:
## rfile:
##   type: File
##   outputBinding:
##     glob: sample.R
## stdout: sample.R</code></pre>
<div class="sourceCode" id="cb69"><html><body><pre class="r"><span class="no">gz1</span>$<span class="no">zfile</span> <span class="kw">&lt;-</span> <span class="no">zzfil</span>
<span class="no">r4a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">gz1</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="no">r4a</span>$<span class="no">output</span></pre></body></html></div>
<pre><code>## [1] "/tmp/Rtmp7zc3UQ/sample.R"</code></pre>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">r4a</span>$<span class="no">output</span>)</pre></body></html></div>
<pre><code>## [1] "sample(1:10, 5)"</code></pre>
<p>To make it for general usage, we can define a pattern with javascript to <em>glob</em> the output, which requires <code>node</code> to be installed in your system PATH:</p>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="no">pfile</span> <span class="kw">&lt;-</span> <span class="st">"$(inputs.zfile.path.split('/').slice(-1)[0].split('.').slice(0,-1).join('.'))"</span></pre></body></html></div>
<p>Or we can directly use the CWL built-in file property, <code>nameroot</code>:</p>
<div class="sourceCode" id="cb76"><html><body><pre class="r"><span class="no">pfile</span> <span class="kw">&lt;-</span> <span class="st">"$(inputs.zfile.nameroot)"</span>
<span class="no">o2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParam.html">OutputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"rfile"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>, <span class="kw">glob</span> <span class="kw">=</span> <span class="no">pfile</span>)
<span class="no">req1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">class</span> <span class="kw">=</span> <span class="st">"InlineJavascriptRequirement"</span>)
<span class="no">gz2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gzip"</span>, <span class="st">"-d"</span>, <span class="st">"-c"</span>),
               <span class="kw">requirements</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(), <span class="co">## assign list(req1) if node installed.</span>
               <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">z1</span>),
               <span class="kw">outputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">OutputParamList</a></span>(<span class="no">o2</span>),
               <span class="kw">stdout</span> <span class="kw">=</span> <span class="no">pfile</span>)
<span class="no">gz2</span>$<span class="no">zfile</span> <span class="kw">&lt;-</span> <span class="no">zzfil</span>
<span class="no">r4b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">gz2</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Array Outputs</li>
</ol>
<p>We can also capture multiple output files by defining a pattern in <code>glob</code>. In the following example, we are only extracting text files to our designated output folder in <code><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL(outdir="")</a></code>.</p>
<div class="sourceCode" id="cb78"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"a"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputArrayParam.html">InputArrayParam</a></span>(<span class="kw">items</span> <span class="kw">=</span> <span class="st">"string"</span>))
<span class="no">b</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParam.html">OutputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"b"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputArrayParam.html">OutputArrayParam</a></span>(<span class="kw">items</span> <span class="kw">=</span> <span class="st">"File"</span>),
                 <span class="kw">glob</span> <span class="kw">=</span> <span class="st">"*.txt"</span>)
<span class="no">touch</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"touch"</span>,
                  <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">a</span>),
                  <span class="kw">outputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">OutputParamList</a></span>(<span class="no">b</span>))
<span class="no">touch</span>$<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a.txt"</span>, <span class="st">"b.gz"</span>, <span class="st">"c.txt"</span>)
<span class="no">r5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">touch</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>())</pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb80"><html><body><pre class="r"><span class="no">r5</span>$<span class="no">output</span></pre></body></html></div>
<pre><code>## [1] "/tmp/Rtmp7zc3UQ/a.txt" "/tmp/Rtmp7zc3UQ/c.txt"</code></pre>
</div>
</div>
<div id="run-approaches" class="section level3">
<h3 class="hasAnchor">
<a href="#run-approaches" class="anchor"></a>Run approaches</h3>
<div id="running-tools-in-parallel" class="section level4">
<h4 class="hasAnchor">
<a href="#running-tools-in-parallel" class="anchor"></a>Running Tools in parallel</h4>
<p>The CWL can also work in high performance clusters with batch-queuing system, such as SGE, PBS, SLURM and so on, using the <em>Bioconductor</em> package <code>BiocParallel</code>. Here is an example to submit jobs with “Multicore” and “SGE”, separately:</p>
<div class="sourceCode" id="cb82"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">BiocParallel</span>)
<span class="no">demolist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">LETTERS</span>[<span class="fl">1</span>:<span class="fl">6</span>])
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">demolist</span>) <span class="kw">&lt;-</span> <span class="no">LETTERS</span>[<span class="fl">1</span>:<span class="fl">6</span>]
<span class="co">## submit with mutlicore</span>
<span class="no">res1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWLBatch.html">runCWLBatch</a></span>(<span class="kw">cwl</span> <span class="kw">=</span> <span class="no">echo</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(),
                    <span class="kw">inputList</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">content</span> <span class="kw">=</span> <span class="no">demolist</span>),
                    <span class="kw">BPPARAM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html">MulticoreParam</a></span>(<span class="fl">4</span>))
<span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">res1</span><span class="kw">[[</span><span class="fl">1</span>]]$<span class="no">output</span>)
<span class="co">## submit with SGE</span>
<span class="no">res2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWLBatch.html">runCWLBatch</a></span>(<span class="kw">cwl</span> <span class="kw">=</span> <span class="no">echo</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(),
                    <span class="kw">inputList</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">content</span> <span class="kw">=</span> <span class="no">demolist</span>),
                    <span class="kw">BPPARAM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/BatchtoolsParam-class.html">BatchtoolsParam</a></span>(<span class="kw">workers</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">cluster</span> <span class="kw">=</span> <span class="st">"sge"</span>,
                                              <span class="kw">resources</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">queue</span> <span class="kw">=</span> <span class="st">"all.q"</span>)))</pre></body></html></div>
</div>
<div id="web-application" class="section level4">
<h4 class="hasAnchor">
<a href="#web-application" class="anchor"></a>Web Application</h4>
<p>Here we build a tool with different types of input parameters, and then use <code>echo</code> to print them out:</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="no">e1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"flag"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"boolean"</span>,
                 <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-f"</span>, <span class="kw">doc</span> <span class="kw">=</span> <span class="st">"boolean flag"</span>)
<span class="no">e2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"string"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-s"</span>)
<span class="no">e3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"option"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-o"</span>)
<span class="no">e4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"int"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"int"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-i"</span>, <span class="kw">default</span> <span class="kw">=</span> <span class="fl">123</span>)
<span class="no">e5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"file"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>,
                 <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"--file="</span>, <span class="kw">separate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="no">e6</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"array"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string[]"</span>, <span class="kw">prefix</span> <span class="kw">=</span> <span class="st">"-A"</span>,
                 <span class="kw">doc</span> <span class="kw">=</span> <span class="st">"separated by comma"</span>)  <span class="co">## "doc" </span>
<span class="no">webEcho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="st">"echo"</span>, <span class="kw">id</span> <span class="kw">=</span> <span class="st">"webEcho"</span>,
                 <span class="kw">label</span> <span class="kw">=</span> <span class="st">"Test parameter types"</span>,
                 <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">e1</span>, <span class="no">e2</span>, <span class="no">e3</span>, <span class="no">e4</span>, <span class="no">e5</span>, <span class="no">e6</span>),
                 <span class="kw">stdout</span> <span class="kw">=</span> <span class="st">"output.txt"</span>)
<span class="no">webEcho</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: echo 
## inputs:
##   flag (boolean): -f 
##   string (string): -s 
##   option (string): -o 
##   int (int): -i 123
##   file (File): --file= 
##   array (string[]): -A 
## outputs:
## output:
##   type: stdout
## stdout: output.txt</code></pre>
<p>Some input parameters can be predefined in a list, which will be converted to selected options in the webapp. An <code>upload</code> parameter can be used to generate an upload interface for the file type option. If set as<code>FALSE</code>, the upload field will be text input (file path) instead of file input.</p>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shiny</span>)
<span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">inputs</a></span>(<span class="no">webEcho</span>)  <span class="co">## define 2 options for the input parameter "option"</span>
<span class="no">inputList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">option</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"option1"</span>, <span class="st">"option2"</span>))
<span class="no">app</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlShiny.html">cwlShiny</a></span>(<span class="no">webEcho</span>, <span class="no">inputList</span>, <span class="kw">upload</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runApp.html">runApp</a></span>(<span class="no">app</span>)</pre></body></html></div>
<div align="center">
<strong>Figure 6:</strong> Shiny webApp for <code>webEcho</code>.
</div>
<p></p>
</div>
</div>
<div id="wrap-r-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#wrap-r-functions" class="anchor"></a>Wrap R functions</h3>
<p><code>Rcwl</code> is also designed to wrap any <em>R</em> function into a cwl tool and then use directly into a pipeline.</p>
<div class="sourceCode" id="cb86"><html><body><pre class="r"><span class="no">anyfun</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span>
<span class="no">rtool</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlParam.html">cwlParam</a></span>(<span class="kw">baseCommand</span> <span class="kw">=</span> <span class="no">anyfun</span>,
                  <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span><span class="kw">=</span><span class="st">"anyinput"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string"</span>)))
<span class="no">rtool</span>$<span class="no">anyinput</span> <span class="kw">&lt;-</span> <span class="st">"abcd"</span>  <span class="co">## assign values for input parameter</span>
<span class="no">rtoolres</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWL.html">runCWL</a></span>(<span class="no">rtool</span>) <span class="co">## execute the CWL script</span></pre></body></html></div>
<pre><code>## [1;30mINFO[0m Final process status is success</code></pre>
<div class="sourceCode" id="cb88"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span>(<span class="no">rtoolres</span>$<span class="no">output</span>)  <span class="co">## check results</span></pre></body></html></div>
<pre><code>## [1] "[1] \"abcd\""</code></pre>
</div>
<div id="build-a-simple-dnaseq-pipeline" class="section level3">
<h3 class="hasAnchor">
<a href="#build-a-simple-dnaseq-pipeline" class="anchor"></a>Build a simple DNASeq pipeline</h3>
<div id="rcwlpipelines-package" class="section level4">
<h4 class="hasAnchor">
<a href="#rcwlpipelines-package" class="anchor"></a>RcwlPipelines package</h4>
<p>We have collected the <em>R</em> scripts building CWL tools and pipelines in a GitHub repository now (<a href="https://github.com/hubentu/RcwlRecipes" class="uri">https://github.com/hubentu/RcwlRecipes</a>), This repository is intended to be a community effort for bioinformatics tools and pipelines built with <em>Rcwl</em> and CWL directly.</p>
<p>Three core functions are defined to extract (<code>cwlUpdate</code>), search (<code>cwlSearch</code>), and load (<code>cwlInstall</code>) the <em>Rcwl</em> recipes to the <em>R</em> environment.</p>
<ol style="list-style-type: decimal">
<li>Indexing recipe scripts</li>
</ol>
<p>The <code>cwlUpdate</code> function updates the recipe scripts from the GitHub repository and collects meta data to a local cache internally using the <code>BiocFileCache</code> package. By default the local cache will be created under your home directory. Here we use temporary directory as an example.</p>
<div class="sourceCode" id="cb90"><html><body><pre class="r"><span class="no">tools</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RcwlPipelines/man/cwlUpdate.html">cwlUpdate</a></span>(<span class="kw">cachePath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>())</pre></body></html></div>
<pre><code>## Update scripts...</code></pre>
<div class="sourceCode" id="cb92"><html><body><pre class="r"><span class="no">tools</span></pre></body></html></div>
<pre><code>## class: BiocFileCache
## bfccache: /tmp/Rtmp7zc3UQ/file518a8f7a24
## bfccount: 126
## For more information see: bfcinfo() or bfcquery()</code></pre>
<p>Let’s take a quick look at this <code>BiocFileCache</code> object.</p>
<div class="sourceCode" id="cb94"><html><body><pre class="r"><span class="fu">bfcinfo</span>(<span class="no">tools</span>)  <span class="co">## show a tibble list with all available tools. Use</span></pre></body></html></div>
<pre><code>## # A tibble: 126 x 13
##    rid   rname create_time access_time rpath rtype fpath last_modified_t… etag 
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;
##  1 BFC1  pl_a… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  2 BFC2  pl_A… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  3 BFC3  pl_B… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  4 BFC4  pl_b… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  5 BFC5  pl_b… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  6 BFC6  pl_b… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  7 BFC7  pl_C… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  8 BFC8  pl_G… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
##  9 BFC9  pl_G… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
## 10 BFC10 pl_h… 2020-07-07… 2020-07-07… /tmp… local /tmp…               NA &lt;NA&gt; 
## # … with 116 more rows, and 4 more variables: expires &lt;dbl&gt;, Type &lt;chr&gt;,
## #   Command &lt;chr&gt;, Container &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb96"><html><body><pre class="r">                <span class="co">## "methods(class="BiocFileCache")" to see all</span>
                <span class="co">## available functions for an "BiocFileCache" object.</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="fu">bfcinfo</span>(<span class="no">tools</span>)$<span class="no">Type</span>)</pre></body></html></div>
<pre><code>## 
## pipeline     tool 
##       25      101</code></pre>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu">bfcinfo</span>(<span class="no">tools</span>)[<span class="fl">1</span>,])</pre></body></html></div>
<pre><code>##    rid         rname         create_time         access_time
## 1 BFC1 pl_alignMerge 2020-07-07 01:38:19 2020-07-07 01:38:19
##                                                                    rpath rtype
## 1 /tmp/Rtmp7zc3UQ/file518a8f7a24/RcwlRecipes-master/Rcwl/pl_alignMerge.R local
##                                                                    fpath
## 1 /tmp/Rtmp7zc3UQ/file518a8f7a24/RcwlRecipes-master/Rcwl/pl_alignMerge.R
##   last_modified_time etag expires     Type                Command Container
## 1                 NA &lt;NA&gt;      NA pipeline bwaAlign + mergeBamDup      &lt;NA&gt;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Search by keyword</li>
</ol>
<p>The function <code>cwlSearch</code> helps to search indexed recipes with keywords. In the following example, let’s find the alignment tool using keywords “bwa” and “mem”.</p>
<div class="sourceCode" id="cb100"><html><body><pre class="r"><span class="no">tl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RcwlPipelines/man/cwlSearch.html">cwlSearch</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"bwa"</span>, <span class="st">"mem"</span>), <span class="no">tools</span>)
<span class="no">tl</span>$<span class="no">rname</span></pre></body></html></div>
<pre><code>## [1] "tl_bwa"</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Load tools and pipelines</li>
</ol>
<p>The function <code>cwlInstall</code> “installs” the tools or pipelines to current environment by given the script path. a</p>
<div class="sourceCode" id="cb102"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/RcwlPipelines/man/cwlInstall.html">cwlInstall</a></span>(<span class="no">tl</span>$<span class="no">rpath</span>)
<span class="no">bwa</span></pre></body></html></div>
<pre><code>## class: cwlParam 
##  cwlClass: CommandLineTool 
##  cwlVersion: v1.0 
##  baseCommand: bwa mem 
## requirements:
## - class: DockerRequirement
##   dockerPull: biocontainers/bwa:v0.7.17-3-deb_cv1
## inputs:
##   threads (int): -t 
##   RG (string): -R 
##   Ref (File):  
##   FQ1 (File):  
##   FQ2 (File?):  
## outputs:
## sam:
##   type: File
##   outputBinding:
##     glob: '*.sam'
## stdout: bwaOutput.sam</code></pre>
<p>We can also install the tools by its “rname” directly.</p>
<div class="sourceCode" id="cb104"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/RcwlPipelines/man/cwlInstall.html">cwlInstall</a></span>(<span class="kw">rname</span> <span class="kw">=</span> <span class="st">'tl_bwa'</span>, <span class="kw">bfc</span> <span class="kw">=</span> <span class="no">tools</span>)</pre></body></html></div>
<p>So now the CWL tool “bwa” is ready to use within <em>R</em>.</p>
</div>
<div id="build-a-pipeline" class="section level4">
<h4 class="hasAnchor">
<a href="#build-a-pipeline" class="anchor"></a>Build a pipeline</h4>
<p>Piplines can be easily built using the available tools. Here we use the tools for mapping and marking duplicates to build a simple alignment pipeline. First, we need to check whether the required tools (bwa, samtools and picard markduplicates) are available in our repository.</p>
<div class="sourceCode" id="cb105"><html><body><pre class="r"><span class="no">tls</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RcwlPipelines/man/cwlSearch.html">cwlSearch</a></span>(<span class="st">"bwa|sam2bam|sortBam|samtools_index|markdup"</span>, <span class="no">tools</span>) <span class="kw">%&gt;%</span>
    <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">Type</span> <span class="kw">==</span> <span class="st">"tool"</span>) <span class="kw">%&gt;%</span>
    <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">rname</span>, <span class="no">rpath</span>, <span class="no">Command</span>, <span class="no">Container</span>)
<span class="no">tls</span></pre></body></html></div>
<pre><code>## # A tibble: 6 x 4
##   rname      rpath                             Command      Container           
##   &lt;chr&gt;      &lt;chr&gt;                             &lt;chr&gt;        &lt;chr&gt;               
## 1 tl_bwa_in… /tmp/Rtmp7zc3UQ/file518a8f7a24/R… bwa index    biocontainers/bwa:v…
## 2 tl_bwa     /tmp/Rtmp7zc3UQ/file518a8f7a24/R… bwa mem      biocontainers/bwa:v…
## 3 tl_markdup /tmp/Rtmp7zc3UQ/file518a8f7a24/R… picard Mark… quay.io/biocontaine…
## 4 tl_sam2bam /tmp/Rtmp7zc3UQ/file518a8f7a24/R… samtools vi… biocontainers/samto…
## 5 tl_samtoo… /tmp/Rtmp7zc3UQ/file518a8f7a24/R… samtools in… biocontainers/samto…
## 6 tl_sortBam /tmp/Rtmp7zc3UQ/file518a8f7a24/R… samtools so… biocontainers/samto…</code></pre>
<p>Let’s load all the tools into <em>R</em> environment.</p>
<div class="sourceCode" id="cb107"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">tls</span>$<span class="no">rpath</span>, <span class="no">cwlInstall</span>))</pre></body></html></div>
<p>Next, we can define the input parameters for the whole pjipeline.</p>
<div class="sourceCode" id="cb108"><html><body><pre class="r"><span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"threads"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"int"</span>)
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"RG"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"string"</span>)
<span class="no">p3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"Ref"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>,
                 <span class="kw">secondaryFiles</span> <span class="kw">=</span>
                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">".amb"</span>, <span class="st">".ann"</span>, <span class="st">".bwt"</span>, <span class="st">".pac"</span>, <span class="st">".sa"</span>))
<span class="no">p4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"FQ1"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>)
<span class="no">p5</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParam.html">InputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"FQ2"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File?"</span>)</pre></body></html></div>
<p>Then we define the pipeline steps using the function <code>Step</code>. This function returns <code>stepParam</code> objects, which contain the internal relation with input and output between steps. In the following example, it defines the pipeline steps to process raw fastqs files into duplicates marked alignments.</p>
<div class="sourceCode" id="cb109"><html><body><pre class="r"><span class="co">## bwa</span>
<span class="no">s1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/Step.html">Step</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"bwa"</span>, <span class="kw">run</span> <span class="kw">=</span> <span class="no">bwa</span>,
           <span class="kw">In</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">threads</span> <span class="kw">=</span> <span class="st">"threads"</span>,
                     <span class="kw">RG</span> <span class="kw">=</span> <span class="st">"RG"</span>,
                     <span class="kw">Ref</span> <span class="kw">=</span> <span class="st">"Ref"</span>,
                     <span class="kw">FQ1</span> <span class="kw">=</span> <span class="st">"FQ1"</span>,
                     <span class="kw">FQ2</span> <span class="kw">=</span> <span class="st">"FQ2"</span>))
<span class="co">## sam to bam</span>
<span class="no">s2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/Step.html">Step</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"sam2bam"</span>, <span class="kw">run</span> <span class="kw">=</span> <span class="no">sam2bam</span>,
           <span class="kw">In</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">sam</span> <span class="kw">=</span> <span class="st">"bwa/sam"</span>))  <span class="co">## the input is the output of "bwa"</span>
<span class="co">## sort bam</span>
<span class="no">s3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/Step.html">Step</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"sortBam"</span>, <span class="kw">run</span> <span class="kw">=</span> <span class="no">sortBam</span>,
           <span class="kw">In</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">bam</span> <span class="kw">=</span> <span class="st">"sam2bam/bam"</span>))
<span class="co">## mark duplicates</span>
<span class="co">## s4 &lt;- Step(id = "markdup", run = markdup,</span>
<span class="co">##            In = list(ibam = "sortBam/sbam",</span>
<span class="co">##                      obam = list(</span>
<span class="co">##                          valueFrom="$(inputs.ibam.nameroot).mdup.bam"),</span>
<span class="co">##                      matrix = list(</span>
<span class="co">##                          valueFrom="$(inputs.ibam.nameroot).markdup.txt")))</span>
<span class="co">## index bam</span>
<span class="no">s4</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/Step.html">Step</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"idxBam"</span>, <span class="kw">run</span> <span class="kw">=</span> <span class="no">samtools_index</span>,
           <span class="kw">In</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">bam</span> <span class="kw">=</span> <span class="st">"sortBam/sbam"</span>))</pre></body></html></div>
<p>Last, we define the outputs for the whole pipeline and connect all steps.</p>
<div class="sourceCode" id="cb110"><html><body><pre class="r"><span class="co">## req1 &lt;- list(class = "StepInputExpressionRequirement")</span>
<span class="co">## req2 &lt;- list(class = "InlineJavascriptRequirement")</span>
<span class="co">## outputs</span>
<span class="co">## o1 &lt;- OutputParam(id = "Bam", type = "File", outputSource = "markdup/mBam")</span>
<span class="no">o1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParam.html">OutputParam</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="st">"Idx"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"File"</span>, <span class="kw">outputSource</span> <span class="kw">=</span> <span class="st">"idxBam/idx"</span>)
<span class="co">## stepParam</span>
<span class="no">Align</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/cwlStepParam.html">cwlStepParam</a></span>(<span class="kw">requirements</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(),
                      <span class="kw">inputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/InputParamList.html">InputParamList</a></span>(<span class="no">p1</span>, <span class="no">p2</span>, <span class="no">p3</span>, <span class="no">p4</span>, <span class="no">p5</span>),
                      <span class="kw">outputs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/OutputParamList.html">OutputParamList</a></span>(<span class="no">o1</span>))
<span class="co">## build pipeline</span>
<span class="no">Align</span> <span class="kw">&lt;-</span> <span class="no">Align</span> + <span class="no">s1</span> + <span class="no">s2</span> + <span class="no">s3</span> + <span class="no">s4</span></pre></body></html></div>
<p>The pipeline is ready for use. We can plot the pipeline with <code>plotCWL</code> from the <code>Rcwl</code> package.</p>
<div class="sourceCode" id="cb111"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/plotCWL.html">plotCWL</a></span>(<span class="no">Align</span>)</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div id="htmlwidget-5d47be3b0d690684f9ad" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-5d47be3b0d690684f9ad">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"threads\", shape = \"rectangle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"0,6!\"] \n  \"2\" [label = \"RG\", shape = \"rectangle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"1,6!\"] \n  \"3\" [label = \"Ref\", shape = \"rectangle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,6!\"] \n  \"4\" [label = \"FQ1\", shape = \"rectangle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"3,6!\"] \n  \"5\" [label = \"FQ2\", shape = \"rectangle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"4,6!\"] \n  \"6\" [label = \"Idx\", shape = \"circle\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,1!\"] \n  \"7\" [label = \"bwa\", shape = \"diamond\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,5!\"] \n  \"8\" [label = \"sam2bam\", shape = \"diamond\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,4!\"] \n  \"9\" [label = \"sortBam\", shape = \"diamond\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,3!\"] \n  \"10\" [label = \"idxBam\", shape = \"diamond\", fillcolor = \"#F0F8FF\", fontcolor = \"#000000\", pos = \"2,2!\"] \n  \"1\"->\"7\" \n  \"2\"->\"7\" \n  \"3\"->\"7\" \n  \"4\"->\"7\" \n  \"5\"->\"7\" \n  \"7\"->\"8\" \n  \"8\"->\"9\" \n  \"9\"->\"10\" \n  \"10\"->\"6\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><div align="center">
<strong>Figure 7:</strong> Visualization for the pipeline <code>Align</code>.
</div>
<p></p>
<p>Now let’s test the pipeline with some real data.</p>
<div class="sourceCode" id="cb113"><html><body><pre class="r"><span class="no">sysdir</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="kw">package</span><span class="kw">=</span><span class="st">"Bioc2020RCWL"</span>)
<span class="no">ids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"normal"</span>, <span class="st">"tumor"</span>)
<span class="no">fq1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">sysdir</span>, <span class="st">"vignettes"</span>, <span class="st">"extdata"</span>), <span class="kw">pattern</span><span class="kw">=</span><span class="st">"1.fq.gz"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">fq2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">sysdir</span>, <span class="st">"vignettes"</span>, <span class="st">"extdata"</span>), <span class="kw">pattern</span><span class="kw">=</span><span class="st">"2.fq.gz"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">fq1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">fq1</span>)
<span class="no">fq2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">fq2</span>)
<span class="no">rg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"@RG"</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"ID:"</span>, <span class="no">ids</span>),
                    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"SM:"</span>, <span class="no">ids</span>), <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"\\t"</span>))
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">fq1</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">fq2</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">rg</span>) <span class="kw">&lt;-</span> <span class="no">ids</span>
<span class="no">inputList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">RG</span> <span class="kw">=</span> <span class="no">rg</span>,
                  <span class="kw">FQ1</span> <span class="kw">=</span> <span class="no">fq1</span>,
                  <span class="kw">FQ2</span> <span class="kw">=</span> <span class="no">fq2</span>)
<span class="no">paramList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">threads</span> <span class="kw">=</span> <span class="fl">2</span>,
                  <span class="kw">Ref</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">sysdir</span>, <span class="st">"vignettes"</span>, <span class="st">"extdata"</span>, <span class="st">"ref.fa"</span>))
<span class="no">result</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Rcwl/man/runCWLBatch.html">runCWLBatch</a></span>(<span class="kw">cwl</span> <span class="kw">=</span> <span class="no">Align</span>, <span class="kw">outdir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="no">inputList</span>,
                      <span class="no">paramList</span>, <span class="kw">BPPARAM</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html">MulticoreParam</a></span>(<span class="fl">2</span>),
                      <span class="kw">stderr</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">cwlTemp</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">docker</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>Check the results:</p>
<div class="sourceCode" id="cb114"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(), <span class="st">"normal"</span>))</pre></body></html></div>
</div>
</div>
</div>
<div id="stepparam" class="section level2">
<h2 class="hasAnchor">
<a href="#stepparam" class="anchor"></a>stepParam</h2>
<p>Align &lt;- cwlStepParam( ## requirements = list(req1), inputs = InputParamList(p1, p2, p3, p4, p5), outputs = OutputParamList(o1)) ### Rcwl tutorial <a href="https://hubentu.github.io/Rcwl" class="uri">https://hubentu.github.io/Rcwl</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Qian Liu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
